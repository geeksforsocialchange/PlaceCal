<%= render partial: 'layouts/admin/datatable', locals: {
    title: 'Neighbourhoods',
    model: :neighbourhoods,
    column_titles: [
      'Neighbourhood',
      'Level',
      'Hierarchy',
      'Partners',
      'Release',
      ''
    ],
    columns: %i[name unit hierarchy partners_count release_date actions],
    column_config: {
      name: {},
      unit: { fit: true },
      hierarchy: { sortable: false },
      partners_count: { fit: true },
      release_date: { fit: true, sortable: false },
      actions: { sortable: false, fit: true }
    },
    default_sort: { column: 'partners_count', direction: 'desc' },
    filters: [
      {
        column: 'unit',
        label: 'Level',
        width: 'w-32',
        options: [
          { value: 'ward', label: 'Ward (L1)' },
          { value: 'district', label: 'District (L2)' },
          { value: 'county', label: 'County (L3)' },
          { value: 'region', label: 'Region (L4)' },
          { value: 'country', label: 'Country (L5)' }
        ]
      },
      {
        column: 'release',
        label: 'Release',
        width: 'w-32',
        default: 'current',
        options: [
          { value: 'current', label: 'Current' },
          { value: 'legacy', label: 'Legacy' }
        ]
      }
    ],
    secondary_filters: [
      {
        column: 'country_id',
        label: 'Country (L5)',
        width: 'min-w-40',
        type: :hierarchical,
        level: 5,
        endpoint: children_admin_neighbourhoods_path(format: :json),
        options: Neighbourhood.countries.latest_release.order(:name).map { |n|
          { value: n.id, label: n.name }
        }
      },
      {
        column: 'region_id',
        label: 'Region (L4)',
        width: 'min-w-48',
        type: :hierarchical,
        level: 4,
        parent_filter: 'country_id',
        endpoint: children_admin_neighbourhoods_path(format: :json)
      },
      {
        column: 'county_id',
        label: 'County (L3)',
        width: 'min-w-48',
        type: :hierarchical,
        level: 3,
        parent_filter: 'region_id',
        endpoint: children_admin_neighbourhoods_path(format: :json)
      },
      {
        column: 'district_id',
        label: 'District (L2)',
        width: 'min-w-48',
        type: :hierarchical,
        level: 2,
        parent_filter: 'county_id',
        endpoint: children_admin_neighbourhoods_path(format: :json)
      }
    ],
    data: @neighbourhoods,
    source: admin_neighbourhoods_path(current_user: @current_user, format: :json)
  }
%>

<h2 class="text-xl font-semibold text-gray-900 mt-8 mb-4">Neighbourhood Roots</h2>

<div class="bg-white shadow-sm rounded-lg p-4">
  <% Neighbourhood.roots.order(:name).each do |root| %>
    <p class="mb-2"><%= link_to safe_neighbourhood_name(root), admin_neighbourhood_path(root), class: "text-placecal-orange-dark hover:underline" %></p>
  <% end %>
</div>

<p class="text-sm text-gray-500 mt-4">ONS Latest Release Date Loaded: <%= Neighbourhood::LATEST_RELEASE_DATE %></p>
