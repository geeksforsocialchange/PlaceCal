<div class="card bg-base-100 border border-base-300">
  <div class="card-body p-4">
    <div class="flex flex-wrap items-start justify-between gap-4">
      <div class="flex-1 min-w-0">
        <h3 class="font-bold text-lg">
          <%= link_to cal.name, edit_admin_calendar_path(cal), class: "link link-hover text-placecal-orange" %>
        </h3>
        <p class="text-sm text-base-content/60 mt-1">
          Partner: <%= link_to cal.partner.name, admin_partner_path(cal.partner), class: "link link-hover" %>
        </p>
      </div>

      <div class="flex items-center gap-2">
        <%
          state_badge = case cal.calendar_state.to_s
            when 'idle' then 'badge-success'
            when 'in_queue', 'in_worker' then 'badge-info'
            when 'error', 'bad_source' then 'badge-error'
            else 'badge-ghost'
          end
        %>
        <span class="badge <%= state_badge %>"><%= cal.calendar_state %></span>
        <span class="badge badge-ghost"><%= cal.events.count %> events</span>
      </div>
    </div>

    <% if cal.critical_error.present? %>
      <div role="alert" class="alert alert-error mt-3 py-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 shrink-0 stroke-current" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
        <span class="text-sm"><%= cal.critical_error %></span>
      </div>
    <% end %>

    <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 mt-4 text-sm">
      <div>
        <p class="text-base-content/50 text-xs uppercase font-medium">Source</p>
        <%= link_to truncate(cal.source, length: 40), cal.source, class: "link link-hover text-xs break-all", target: "_blank" %>
      </div>

      <div>
        <p class="text-base-content/50 text-xs uppercase font-medium">Strategy</p>
        <p class="font-medium"><%= cal.strategy %></p>
      </div>

      <div>
        <p class="text-base-content/50 text-xs uppercase font-medium">Importer</p>
        <p class="font-medium"><%= cal.importer_used.presence || '—' %></p>
      </div>

      <div>
        <p class="text-base-content/50 text-xs uppercase font-medium">Last Import</p>
        <p class="font-medium"><%= cal.last_import_at.present? ? time_ago_in_words(cal.last_import_at) + ' ago' : '—' %></p>
      </div>
    </div>
  </div>
</div>
