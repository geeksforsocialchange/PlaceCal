<%= simple_form_for [:admin, @site], html: { data: { controller: 'site-tabs live-validation' } } do |f| %>
  <%= render(ErrorComponent.new(@site)) %>

  <%# Radio Tabs - daisyUI tabs-lift %>
  <div role="tablist" class="tabs tabs-lift">
    <input type="radio" name="site_tabs" class="tab" aria-label="ðŸ“‹ Basic Info" data-site-tabs-target="tab" data-hash="basic" checked="checked" />
    <div class="tab-content bg-base-100 border-base-300 p-6" data-site-tabs-target="panel" data-section="basic">
      <h2 class="text-lg font-bold mb-1">Basic Information</h2>
      <p class="text-sm text-base-content/60 mb-6">Core details about this site.</p>

      <div class="max-w-2xl space-y-4">
        <fieldset class="fieldset">
          <legend class="fieldset-legend">Site Name <span class="text-error">*</span></legend>
          <%= f.input_field :name, class: 'input input-bordered w-full' %>
        </fieldset>

        <% if policy(@site).permitted_attributes.include? :site_admin_id %>
          <fieldset class="fieldset">
            <legend class="fieldset-legend">Site Admin</legend>
            <%= f.select :site_admin_id,
                  User.order(:last_name, :first_name).map { |u|
                    full_name = [u.first_name, u.last_name].compact.join(' ').presence
                    label = full_name ? "#{full_name} (#{u.email})" : u.email
                    [label, u.id]
                  },
                  { include_blank: 'Select an admin...' },
                  { class: 'select select-bordered w-full' } %>
          </fieldset>
        <% else %>
          <%
            admin = @site.site_admin
            admin_display = if admin
              full_name = [admin.first_name, admin.last_name].compact.join(' ').presence
              full_name ? "#{full_name} (#{admin.email})" : admin.email
            else
              'None'
            end
          %>
          <div class="card bg-base-200/50 border border-base-300 p-3">
            <p class="text-sm"><strong>Admin:</strong> <%= admin_display %></p>
          </div>
        <% end %>

        <fieldset class="fieldset">
          <legend class="fieldset-legend">Place Name</legend>
          <%= f.input_field :place_name, class: 'input input-bordered w-full' %>
          <p class="fieldset-label">The location this site covers (e.g., "Hulme")</p>
        </fieldset>

        <fieldset class="fieldset">
          <legend class="fieldset-legend">Tagline</legend>
          <%= f.input_field :tagline, class: 'input input-bordered w-full' %>
        </fieldset>

        <fieldset class="fieldset" data-controller="char-counter" data-char-counter-max-value="120">
          <legend class="fieldset-legend">Hero Text</legend>
          <%= f.input_field :hero_text, as: :text, class: 'textarea textarea-bordered w-full min-h-20', maxlength: 120, data: { controller: 'auto-expand', char_counter_target: 'input', action: 'input->char-counter#update' } %>
          <div class="flex items-center justify-between mt-1">
            <p class="fieldset-label">Large text for the homepage banner</p>
            <span class="text-xs tabular-nums transition-colors" data-char-counter-target="counter">0 / 120</span>
          </div>
        </fieldset>

        <fieldset class="fieldset">
          <legend class="fieldset-legend">Description</legend>
          <%= f.input_field :description, as: :text, class: 'textarea textarea-bordered w-full min-h-32', data: { controller: 'auto-expand' } %>
        </fieldset>
      </div>
    </div>

    <input type="radio" name="site_tabs" class="tab" aria-label="ðŸ–¼ï¸ Images" data-site-tabs-target="tab" data-hash="images" />
    <div class="tab-content bg-base-100 border-base-300 p-6" data-site-tabs-target="panel" data-section="images">
      <h2 class="text-lg font-bold mb-1">Images & Theme</h2>
      <p class="text-sm text-base-content/60 mb-6">Logos, hero image, and visual theme for the site.</p>

      <% if policy(@site).permitted_attributes.include? :theme %>
        <fieldset class="fieldset max-w-xs mb-8">
          <legend class="fieldset-legend">Theme</legend>
          <%= f.input_field :theme, as: :select, collection: Site.theme.values.map { |v| [v.to_s.titleize, v] }, class: 'select select-bordered w-full' %>
        </fieldset>
      <% end %>

      <% if policy(@site).permitted_attributes.include? :logo %>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
          <div>
            <fieldset class="fieldset">
              <legend class="fieldset-legend">Logo</legend>
              <div data-controller="image-preview">
                <label class="flex items-center gap-3 p-3 rounded-lg border-2 border-dashed border-base-300 hover:border-placecal-orange transition-colors cursor-pointer mb-3">
                  <div class="flex-shrink-0 w-10 h-10 rounded-lg bg-placecal-orange/10 flex items-center justify-center">
                    <svg class="size-5 text-placecal-orange" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/></svg>
                  </div>
                  <div class="flex-1 min-w-0">
                    <p class="text-sm font-medium">Choose file</p>
                    <p class="text-xs text-base-content/50"><%= image_uploader_hint(@site.logo) %></p>
                  </div>
                  <%= f.input_field :logo, as: :file, class: 'sr-only', data: { action: "change->image-preview#file", image_preview_target: "input" } %>
                </label>
                <% if f.object.logo.url %>
                  <%= image_tag f.object.logo.url, class: 'max-w-full max-h-32 rounded-lg border border-base-300', data: { image_preview_target: "img" } %>
                <% end %>
              </div>
            </fieldset>
          </div>

          <div>
            <fieldset class="fieldset">
              <legend class="fieldset-legend">Footer Logo</legend>
              <div data-controller="image-preview">
                <label class="flex items-center gap-3 p-3 rounded-lg border-2 border-dashed border-base-300 hover:border-placecal-orange transition-colors cursor-pointer mb-3">
                  <div class="flex-shrink-0 w-10 h-10 rounded-lg bg-placecal-orange/10 flex items-center justify-center">
                    <svg class="size-5 text-placecal-orange" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/></svg>
                  </div>
                  <div class="flex-1 min-w-0">
                    <p class="text-sm font-medium">Choose file</p>
                    <p class="text-xs text-base-content/50"><%= image_uploader_hint(@site.footer_logo) %></p>
                  </div>
                  <%= f.input_field :footer_logo, as: :file, class: 'sr-only', data: { action: "change->image-preview#file", image_preview_target: "input" } %>
                </label>
                <% if f.object.footer_logo.url %>
                  <div class="bg-neutral p-4 rounded-lg inline-block">
                    <%= image_tag f.object.footer_logo.url, class: 'max-w-full max-h-24', data: { image_preview_target: "img" } %>
                  </div>
                <% end %>
              </div>
            </fieldset>
          </div>
        </div>
      <% end %>

      <fieldset class="fieldset bg-base-200/50 border border-base-300 rounded-box p-4">
        <legend class="fieldset-legend">Hero Image</legend>
        <p class="text-sm text-base-content/60 mb-4">
          The large image at the top of your site's homepage.
          <a href="https://gfsc.notion.site/Homepage-Images-f0a19b7f8f5446948bc4601950c9a0a2" class="link link-hover text-placecal-orange" target="_blank">See handbook for guidance</a>
        </p>

        <div data-controller="image-preview">
          <label class="flex items-center gap-3 p-3 rounded-lg border-2 border-dashed border-base-300 hover:border-placecal-orange transition-colors cursor-pointer bg-base-100 mb-4">
            <div class="flex-shrink-0 w-10 h-10 rounded-lg bg-placecal-orange/10 flex items-center justify-center">
              <svg class="size-5 text-placecal-orange" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/></svg>
            </div>
            <div class="flex-1 min-w-0">
              <p class="text-sm font-medium">Choose file</p>
              <p class="text-xs text-base-content/50"><%= image_uploader_hint(@site.hero_image) %></p>
            </div>
            <%= f.input_field :hero_image, as: :file, class: 'sr-only', data: { action: "change->image-preview#file", image_preview_target: "input" } %>
          </label>

          <% if f.object.hero_image.url %>
            <%= image_tag f.object.hero_image.url, class: 'max-w-md rounded-lg border border-base-300 mb-4', data: { image_preview_target: "img" } %>
          <% end %>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <fieldset class="fieldset">
            <legend class="fieldset-legend">Image Credit</legend>
            <%= f.input_field :hero_image_credit, class: 'input input-bordered w-full input-sm bg-base-100' %>
            <p class="fieldset-label">Who took this photo?</p>
          </fieldset>

          <fieldset class="fieldset">
            <legend class="fieldset-legend">Alt Text</legend>
            <%= f.input_field :hero_alttext, class: 'input input-bordered w-full input-sm bg-base-100' %>
            <p class="fieldset-label">How should a screen reader describe this image?</p>
          </fieldset>
        </div>
      </fieldset>
    </div>

    <input type="radio" name="site_tabs" class="tab" aria-label="ðŸ“ Neighbourhoods" data-site-tabs-target="tab" data-hash="neighbourhoods" />
    <div class="tab-content bg-base-100 border-base-300 p-6" data-site-tabs-target="panel" data-section="neighbourhoods">
      <h2 class="text-lg font-bold mb-1">Neighbourhoods</h2>
      <p class="text-sm text-base-content/60 mb-6">Define the geographical areas this site covers.</p>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <fieldset class="fieldset bg-base-200/50 border border-base-300 rounded-box p-4">
          <legend class="fieldset-legend">Main Neighbourhood</legend>
          <p class="text-sm text-base-content/60 mb-4">This neighbourhood will be listed in the main PlaceCal directory. It cannot be changed after the site is created.</p>

          <%= f.simple_fields_for :sites_neighbourhood do |sn| %>
            <% primary_neighbourhood = (@all_neighbourhoods.where(id: @primary_neighbourhood_id).first if @primary_neighbourhood_id.present?) %>
            <% if primary_neighbourhood.present? %>
              <div class="mb-3">
                <span class="badge badge-lg badge-neutral gap-2">
                  <svg class="size-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/></svg>
                  <%= primary_neighbourhood.contextual_name %>
                  <% if primary_neighbourhood.legacy_neighbourhood? %>
                    (<%= primary_neighbourhood.release_date.year %>/<%= primary_neighbourhood.release_date.month %>)
                  <% end %>
                </span>
              </div>
              <%= sn.hidden_field :relation_type, value: "Primary" %>
              <%= sn.hidden_field :neighbourhood_id, value: primary_neighbourhood.id %>
              <% if primary_neighbourhood.legacy_neighbourhood? %>
                <div role="alert" class="alert alert-warning py-2">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 shrink-0 stroke-current" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>
                  <span class="text-sm">This neighbourhood is not from the current release. Please contact a PlaceCal admin.</span>
                </div>
              <% end %>
            <% else %>
              <%= sn.hidden_field :relation_type, value: "Primary" %>
              <div class="site_sites_neighbourhood_neighbourhood_id">
                <%= sn.input :neighbourhood_id, collection: options_for_sites_neighbourhoods(@site), include_blank: false,
                    value_method: ->(obj) { obj[:id] }, label_method: ->(obj) { obj[:name] },
                    input_html: { data: { controller: "tom-select" }, class: 'select select-bordered w-full bg-base-100' },
                    label: '', label_html: { hidden: true }, wrapper: false %>
              </div>
            <% end %>
          <% end %>
        </fieldset>

        <fieldset class="fieldset bg-base-200/50 border border-base-300 rounded-box p-4">
          <legend class="fieldset-legend">Display Level</legend>
          <p class="text-sm text-base-content/60 mb-4">What level of geographical zoom should PlaceCal display in badges next to partners and events?</p>

          <div class="space-y-3">
            <% Site.badge_zoom_level.values.each do |zoom_value| %>
              <label class="flex items-start gap-3 p-3 rounded-lg border border-base-300 bg-base-100 hover:bg-base-200/50 cursor-pointer transition-colors has-[:checked]:border-placecal-orange has-[:checked]:bg-orange-50/50">
                <%= f.radio_button :badge_zoom_level, zoom_value, class: 'radio radio-warning mt-0.5' %>
                <span class="text-sm leading-relaxed"><%= zoom_value.to_s.titleize %></span>
              </label>
            <% end %>
          </div>
        </fieldset>
      </div>

      <div class="mt-8">
        <h3 class="font-semibold mb-2">Other Neighbourhoods</h3>
        <p class="text-sm text-base-content/60 mb-4">Information from these neighbourhoods will also be displayed on this site.</p>

        <% if policy(@site).permitted_attributes.include? :sites_neighbourhoods %>
          <div class="space-y-2">
            <%= nested_form_for(f, :sites_neighbourhoods,
                  add_text: 'Add neighbourhood',
                  add_class: 'btn btn-sm bg-placecal-orange hover:bg-orange-600 text-white border-placecal-orange',
                  partial: 'sites_neighbourhood_fields') do %>
              <%= f.simple_fields_for :sites_neighbourhoods do |neighbourhood| %>
                <%= render 'sites_neighbourhood_fields', f: neighbourhood %>
              <% end %>
            <% end %>
          </div>
        <% else %>
          <% secondary_neighbourhoods = @site.sites_neighbourhoods.select { |n| n.relation_type != 'Primary' } %>
          <% if secondary_neighbourhoods.any? %>
            <div class="flex flex-wrap gap-2">
              <% secondary_neighbourhoods.each do |neighbourhood| %>
                <span class="badge badge-outline"><%= neighbourhood.name %></span>
              <% end %>
            </div>
          <% else %>
            <p class="text-sm text-base-content/50 italic">No additional neighbourhoods</p>
          <% end %>
        <% end %>
      </div>
    </div>

    <input type="radio" name="site_tabs" class="tab" aria-label="ðŸ·ï¸ Partnerships" data-site-tabs-target="tab" data-hash="partnerships" />
    <div class="tab-content bg-base-100 border-base-300 p-6" data-site-tabs-target="panel" data-section="partnerships">
      <h2 class="text-lg font-bold mb-1">Partnerships</h2>
      <p class="text-sm text-base-content/60 mb-6">Filter which partners appear on this site.</p>

      <div class="max-w-xl">
        <fieldset class="fieldset">
          <legend class="fieldset-legend">Partnership Tags</legend>
          <p class="fieldset-label mb-3">If selected, only show partners which are members of these partnerships.</p>
          <div class="site_tags">
            <% if policy(@site).permitted_attributes.include? :tags %>
              <%= f.input_field :tag_ids,
                    as: :select,
                    collection: options_for_tags,
                    multiple: true,
                    class: 'select select-bordered w-full',
                    data: { controller: "tom-select" } %>
            <% else %>
              <%= f.input_field :tag_ids,
                    as: :select,
                    collection: options_for_tags,
                    multiple: true,
                    class: 'select select-bordered w-full bg-base-200',
                    disabled: true,
                    data: { controller: "tom-select" } %>
            <% end %>
          </div>
        </fieldset>

      </div>
    </div>

    <% unless @site.new_record? %>
      <input type="radio" name="site_tabs" class="tab" aria-label="ðŸ‘ï¸ Preview" data-site-tabs-target="tab" data-hash="preview" />
      <div class="tab-content bg-base-100 border-base-300 p-6" data-site-tabs-target="panel" data-section="preview">
        <h2 class="text-lg font-bold mb-1">Site Content Preview</h2>
        <p class="text-sm text-base-content/60 mb-6">Partners and events that will appear on this site.</p>

        <%# Partners Section %>
        <div class="mb-8">
          <% site_partners = Partner.for_site(@site).order(:name) %>
          <h3 class="text-lg font-bold mb-1 flex items-center gap-2">
            <svg class="size-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/></svg>
            Partners
            <span class="badge badge-neutral"><%= site_partners.count %></span>
          </h3>
          <p class="text-sm text-base-content/60 mb-4">Partners visible on this site.</p>

          <% if site_partners.any? %>
            <div class="overflow-x-auto">
              <table class="table table-sm table-zebra">
                <thead>
                  <tr>
                    <th>Partner</th>
                    <th>Calendars</th>
                    <th>Events</th>
                  </tr>
                </thead>
                <tbody>
                  <% site_partners.limit(50).each do |partner| %>
                    <tr>
                      <td>
                        <%= link_to edit_admin_partner_path(partner), class: "link link-hover text-placecal-orange font-medium" do %>
                          <%= partner.name %>
                        <% end %>
                        <% if partner.hidden %>
                          <span class="badge badge-error badge-xs ml-1">Hidden</span>
                        <% end %>
                      </td>
                      <td><%= partner.calendars.count %></td>
                      <td><%= partner.events.upcoming.count %></td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            </div>
            <% if site_partners.count > 50 %>
              <p class="text-sm text-base-content/60 mt-2">Showing first 50 of <%= site_partners.count %> partners.</p>
            <% end %>
          <% else %>
            <div class="text-center py-8">
              <svg class="mx-auto h-10 w-10 text-base-content/30" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"/>
              </svg>
              <p class="mt-2 text-base-content/60">No partners on this site yet</p>
            </div>
          <% end %>
        </div>

        <div class="divider"></div>

        <%# Events Section %>
        <div>
          <% site_events = Event.for_site(@site).upcoming.where(dtstart: ..30.days.from_now).order(:dtstart) %>
          <h3 class="text-lg font-bold mb-1 flex items-center gap-2">
            <svg class="size-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
            Upcoming Events
            <span class="badge badge-neutral"><%= site_events.count %></span>
          </h3>
          <p class="text-sm text-base-content/60 mb-4">Events in the next 30 days.</p>

          <% if site_events.any? %>
            <div class="overflow-x-auto">
              <table class="table table-sm table-zebra">
                <thead>
                  <tr>
                    <th>Event</th>
                    <th>Date & Time</th>
                    <th>Partner</th>
                    <th>Calendar</th>
                  </tr>
                </thead>
                <tbody>
                  <% site_events.limit(30).each do |event| %>
                    <tr>
                      <td>
                        <div class="font-medium"><%= truncate(event.summary, length: 40) %></div>
                      </td>
                      <td class="whitespace-nowrap text-sm">
                        <%= event.dtstart.strftime('%a %d %b %H:%M') %>
                      </td>
                      <td>
                        <% if event.partner %>
                          <%= link_to truncate(event.partner.name, length: 25), edit_admin_partner_path(event.partner), class: "link text-placecal-orange hover:text-orange-600 text-sm" %>
                        <% end %>
                      </td>
                      <td>
                        <% if event.calendar %>
                          <%= link_to truncate(event.calendar.name, length: 20), edit_admin_calendar_path(event.calendar), class: "link text-placecal-orange hover:text-orange-600 text-sm" %>
                        <% end %>
                      </td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            </div>
            <% if site_events.count > 30 %>
              <p class="text-sm text-base-content/60 mt-2">Showing first 30 of <%= site_events.count %> events.</p>
            <% end %>
          <% else %>
            <div class="text-center py-8">
              <svg class="mx-auto h-10 w-10 text-base-content/30" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
              </svg>
              <p class="mt-2 text-base-content/60">No upcoming events in the next 30 days</p>
            </div>
          <% end %>
        </div>
      </div>

      <%# Spacer to push Admin tab right %>
      <div class="tab flex-1 cursor-default"></div>

      <input type="radio" name="site_tabs" class="tab" aria-label="âš™ Admin" data-site-tabs-target="tab" data-hash="admin" />
      <div class="tab-content bg-base-100 border-base-300 p-6" data-site-tabs-target="panel" data-section="admin">
        <h2 class="text-lg font-bold mb-1">Admin Settings</h2>
        <p class="text-sm text-base-content/60 mb-6">Publishing, URLs, and site management options.</p>

        <div class="max-w-xl space-y-8">
          <fieldset class="fieldset">
            <legend class="fieldset-legend">Publishing Status</legend>
            <label class="flex items-center gap-3 p-4 rounded-lg border border-base-300 bg-base-100 cursor-pointer transition-colors has-[:checked]:border-success has-[:checked]:bg-success/10">
              <%= f.check_box :is_published, class: 'checkbox checkbox-success' %>
              <div>
                <p class="font-medium">Published</p>
                <p class="text-sm text-base-content/60">Advertise this site on the PlaceCal homepage</p>
              </div>
            </label>
          </fieldset>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <fieldset class="fieldset">
              <legend class="fieldset-legend">URL <span class="text-error">*</span></legend>
              <% if policy(@site).permitted_attributes.include? :url %>
                <%= f.input_field :url, class: 'input input-bordered w-full font-mono text-sm' %>
              <% else %>
                <%= f.input_field :url, class: 'input input-bordered w-full font-mono text-sm bg-base-200', disabled: true %>
              <% end %>
            </fieldset>

            <fieldset class="fieldset">
              <legend class="fieldset-legend">Slug <span class="text-error">*</span></legend>
              <% if policy(@site).permitted_attributes.include? :slug %>
                <%= f.input_field :slug, class: 'input input-bordered w-full font-mono text-sm' %>
              <% else %>
                <%= f.input_field :slug, class: 'input input-bordered w-full font-mono text-sm bg-base-200', disabled: true %>
              <% end %>
            </fieldset>
          </div>

          <div class="divider"></div>

          <div>
            <h3 class="text-lg font-bold text-error mb-4">Danger Zone</h3>
            <div class="card bg-error/5 border border-error/20">
              <div class="card-body p-4">
                <h4 class="font-semibold flex items-center gap-2">
                  <svg class="size-5 text-error" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
                  Delete this site
                </h4>
                <p class="text-sm text-base-content/70 mt-2">
                  Permanently remove this site. This action cannot be undone.
                </p>
                <div class="mt-4">
                  <%= link_to admin_site_path(@site), method: :delete, class: "btn btn-error btn-sm", data: { confirm: "Delete this site permanently? This cannot be undone." } do %>
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
                    Delete Site
                  <% end %>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  </div>

  <%# Sticky Save Bar %>
  <div class="sticky bottom-0 bg-base-200 border-t border-base-300 p-4 -mx-4 sm:-mx-6 mt-6 flex justify-end gap-3 shadow-lg">
    <%= f.submit "Save", class: "btn btn-outline border-placecal-orange text-placecal-orange hover:bg-placecal-orange hover:text-white hover:border-placecal-orange" %>
    <%= f.submit "Save & Continue", class: "btn bg-placecal-orange hover:bg-orange-600 text-white border-placecal-orange" %>
  </div>
<% end %>
