<%= simple_form_for [:admin, @article], html: { class: 'space-y-6', data: { controller: 'form-tabs live-validation', 'form-tabs-storage-key-value': 'articleTabAfterSave' } } do |f| %>

  <%= render(Admin::ErrorComponent.new(@article)) %>

  <% if @article.new_record? %>
    <%# New record - single page layout %>
    <div class="card bg-base-100 border border-base-300 shadow-sm">
      <div class="card-body p-6">
        <%= render 'admin/articles/form_tab_text', f: f %>
      </div>
    </div>

    <div class="card bg-base-100 border border-base-300 shadow-sm">
      <div class="card-body p-6">
        <%= render Admin::SectionHeaderComponent.new(
          title: "Image",
          description: "Image will be cropped to 16:9 ratio.",
          margin: 4
        ) %>
        <%= render 'admin/articles/form_tab_image', f: f %>
      </div>
    </div>

    <div class="card bg-base-100 border border-base-300 shadow-sm">
      <div class="card-body p-6">
        <%= render Admin::SectionHeaderComponent.new(
          title: "References",
          description: "Link this article to partners and partnerships.",
          margin: 4
        ) %>
        <%= render 'admin/articles/form_tab_references', f: f %>
      </div>
    </div>

    <%= render Admin::SaveBarComponent.new do |c| %>
      <% c.with_button do %>
        <%= f.submit t('admin.actions.save'), class: "btn bg-placecal-orange hover:bg-orange-600 text-white border-placecal-orange" %>
      <% end %>
    <% end %>
  <% else %>
    <%# Existing record - tabbed interface %>
    <div role="tablist" class="tabs tabs-lift">
      <%= render Admin::TabPanelComponent.new(
        name: 'article_tabs',
        label: 'ðŸ“ Text',
        hash: 'text',
        controller_name: 'form-tabs',
        checked: true
      ) do %>
        <%= render 'admin/articles/form_tab_text', f: f %>
      <% end %>

      <%= render Admin::TabPanelComponent.new(
        name: 'article_tabs',
        label: 'ðŸ–¼ï¸ Image',
        hash: 'image',
        controller_name: 'form-tabs'
      ) do %>
        <%= render 'admin/articles/form_tab_image', f: f %>
      <% end %>

      <%= render Admin::TabPanelComponent.new(
        name: 'article_tabs',
        label: 'ðŸ”— References',
        hash: 'references',
        controller_name: 'form-tabs'
      ) do %>
        <%= render 'admin/articles/form_tab_references', f: f %>
      <% end %>

      <%# Spacer to push Settings tab right %>
      <div class="tab flex-1 cursor-default"></div>

      <%= render Admin::TabPanelComponent.new(
        name: 'article_tabs',
        label: 'âš™ï¸ Settings',
        hash: 'settings',
        controller_name: 'form-tabs'
      ) do %>
        <%= render 'admin/articles/form_tab_settings', f: f %>
      <% end %>
    </div>

    <%= render Admin::SaveBarComponent.new(
      multi_step: true,
      tab_name: 'article_tabs',
      settings_hash: 'settings',
      storage_key: 'articleTabAfterSave'
    ) %>
  <% end %>
<% end %>
