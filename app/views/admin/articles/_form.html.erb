<%- disabled_fields = policy(@article).disabled_fields %>
<%= simple_form_for [:admin, @article], html: { class: 'space-y-6' } do |f| %>

  <%= render(Admin::ErrorComponent.new(@article)) %>

  <div class="bg-white shadow-sm rounded-lg p-6 space-y-4">
    <h3 class="text-lg font-medium text-gray-900 border-b border-gray-200 pb-2">Article Content</h3>

    <%= f.input :title, id: :article_title, as: :string, wrapper: :tw_vertical_form,
                input_html: { class: 'block w-full rounded-md border-gray-300 shadow-sm focus:border-placecal-orange focus:ring-placecal-orange sm:text-sm' } %>

    <%= f.association :author, wrapper: :tw_vertical_form,
                      input_html: { class: 'block w-full', data: { controller: "tom-select" } } %>

    <%= f.input :body, wrapper: :tw_vertical_form,
                input_html: { class: 'block w-full rounded-md border-gray-300 shadow-sm focus:border-placecal-orange focus:ring-placecal-orange sm:text-sm font-mono', rows: 20 } %>
    <p class="text-sm text-gray-500">This field accepts <a href="https://www.markdownguide.org/basic-syntax/" class="text-placecal-teal hover:underline" target="_blank">Markdown syntax</a>.</p>
  </div>

  <div class="bg-white shadow-sm rounded-lg p-6 space-y-4">
    <h3 class="text-lg font-medium text-gray-900 border-b border-gray-200 pb-2">Image</h3>
    <p class="text-sm text-gray-600">Image will be cropped to 16:9 ratio.</p>

    <%= f.input :article_image, wrapper: :tw_file,
        disabled: disabled_fields.include?(:article_image),
        label: false,
        hint: image_uploader_hint(@article.article_image) %>

    <% if f.object.article_image.highres.url %>
      <div class="mt-4">
        <%= image_tag f.object.article_image.highres.url, class: 'rounded-lg max-w-md' %>
      </div>
    <% end %>
  </div>

  <div class="bg-white shadow-sm rounded-lg p-6 space-y-4">
    <h3 class="text-lg font-medium text-gray-900 border-b border-gray-200 pb-2">Connected Entities</h3>
    <p class="text-sm text-gray-600">What other things is this article linked to?</p>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
      <div>
        <h4 class="text-sm font-medium text-gray-700 mb-2">Partners</h4>
        <% if disabled_fields.include?(:partner_ids) %>
          <%= f.input :partners, collection: options_for_partners, wrapper: :tw_vertical_form,
              input_html: { class: 'block w-full', data: { controller: "tom-select" } },
              disabled: true, label: false %>
        <% else %>
          <%= f.association :partners, collection: options_for_partners, wrapper: :tw_vertical_form,
              input_html: { class: 'block w-full', data: { controller: "tom-select" } },
              label: false %>
        <% end %>
      </div>
      <div>
        <h4 class="text-sm font-medium text-gray-700 mb-2">Partnerships</h4>
        <% if disabled_fields.include?(:tag_ids) %>
          <%= f.input :tags, collection: options_for_tags, wrapper: :tw_vertical_form,
              input_html: { class: 'block w-full', data: { controller: "tom-select" } },
              disabled: true, label: false %>
        <% else %>
          <%= f.association :tags, collection: options_for_tags, wrapper: :tw_vertical_form,
              input_html: { class: 'block w-full', data: { controller: "tom-select" } },
              label: false %>
        <% end %>
      </div>
    </div>
  </div>

  <div class="bg-white shadow-sm rounded-lg p-6 space-y-4">
    <h3 class="text-lg font-medium text-gray-900 border-b border-gray-200 pb-2">Publish</h3>
    <p class="text-sm text-gray-600">This box must be checked for the article to show up on the PlaceCal frontend and API feed.</p>

    <%= f.input :is_draft, wrapper: :tw_boolean,
                as: :boolean,
                checked_value: false,
                unchecked_value: true,
                label: "Publish this article!" %>

    <% unless @article.new_record? %>
      <% if disabled_fields.include?(:published_at) %>
        <p class="text-sm text-gray-600">
          Published <%= @article.published_at %>.<br>
          Last updated <%= @article.updated_at %>.
        </p>
      <% else %>
        <%= f.input :published_at, wrapper: :tw_vertical_form,
                    label: 'Publication date',
                    input_html: { class: 'block w-full rounded-md border-gray-300 shadow-sm focus:border-placecal-orange focus:ring-placecal-orange sm:text-sm' } %>
      <% end %>
    <% end %>
  </div>

  <div class="flex items-center gap-4 pt-4">
    <%= f.submit 'Save Article', class: "inline-flex justify-center rounded-md bg-placecal-orange px-6 py-3 text-base font-semibold text-white shadow-sm hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-placecal-orange focus:ring-offset-2" %>
    <% if !@article.new_record? && policy(@article).destroy? %>
      <%= link_to "Delete Article", admin_article_path(@article), method: :delete,
          class: "inline-flex justify-center rounded-md bg-red-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-500",
          data: { confirm: "Are you sure you want to delete this article?" } %>
    <% end %>
  </div>
<% end %>
