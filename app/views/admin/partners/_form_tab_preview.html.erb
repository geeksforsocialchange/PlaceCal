<%= render Admin::SectionHeaderComponent.new(
  title: t('admin.partners.sections.live_preview'),
  description: t('admin.partners.sections.preview_description')
) %>

<div class="mockup-browser bg-base-300 border border-base-300 max-w-4xl">
  <div class="mockup-browser-toolbar">
    <div class="input text-sm">placecal.org/partners/<%= @partner.slug %></div>
  </div>
  <div class="bg-base-100">
    <%# Partner Header %>
    <div class="bg-neutral text-neutral-content p-6">
      <h1 class="text-2xl font-bold"><%= @partner.name %></h1>
      <% if @partner.summary.present? %>
        <p class="mt-2 text-neutral-content/80"><%= @partner.summary %></p>
      <% end %>
    </div>

    <div class="p-6">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <div class="lg:col-span-2">
          <% if @partner.description_html.present? %>
            <div class="prose prose-sm max-w-none">
              <%= @partner.description_html.to_s.html_safe %>
            </div>
          <% else %>
            <p class="text-base-content/50 italic"><%= t('admin.partners.preview.no_description') %></p>
          <% end %>

          <% if @partner.accessibility_info.present? %>
            <div class="mt-6">
              <h3 class="font-semibold mb-2"><%= t('admin.sections.accessibility') %></h3>
              <p class="text-sm"><%= @partner.accessibility_info %></p>
            </div>
          <% end %>
        </div>

        <div class="space-y-4">
          <% if @partner.image.present? %>
            <%= image_tag @partner.image.standard.url, class: 'rounded-box w-full' %>
          <% else %>
            <div class="bg-base-200 rounded-box aspect-square flex items-center justify-center">
              <span class="text-base-content/30 text-sm"><%= t('admin.images.no_image') %></span>
            </div>
          <% end %>

          <div class="card bg-base-200 card-body p-4 text-sm">
            <% if @partner.address&.to_s.present? %>
              <div class="mb-3">
                <div class="font-semibold text-xs uppercase text-base-content/60 mb-1"><%= t('admin.fields.address') %></div>
                <p><%= @partner.address %></p>
              </div>
            <% end %>

            <% if @partner.url.present? %>
              <div class="mb-3">
                <div class="font-semibold text-xs uppercase text-base-content/60 mb-1"><%= t('admin.fields.website') %></div>
                <%= link_to @partner.url, @partner.url, target: '_blank', class: 'link text-placecal-orange hover:text-orange-600 break-all' %>
              </div>
            <% end %>

            <% if @partner.public_email.present? %>
              <div class="mb-3">
                <div class="font-semibold text-xs uppercase text-base-content/60 mb-1"><%= t('admin.fields.email') %></div>
                <%= mail_to @partner.public_email, @partner.public_email, class: 'link text-placecal-orange hover:text-orange-600' %>
              </div>
            <% end %>

            <% if @partner.public_phone.present? %>
              <div>
                <div class="font-semibold text-xs uppercase text-base-content/60 mb-1"><%= t('admin.fields.phone') %></div>
                <p><%= @partner.public_phone %></p>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="divider my-8"></div>

<%= render Admin::SectionHeaderComponent.new(
  title: t('admin.sections.upcoming_events'),
  description: t('admin.partners.sections.upcoming_events_description'),
  tag: :h3
) %>

<% upcoming_events = @partner.events.upcoming.where(dtstart: ..30.days.from_now).order(:dtstart).limit(20) %>
<% if upcoming_events.any? %>
  <div class="overflow-x-auto">
    <table class="table table-sm table-zebra">
      <thead>
        <tr>
          <th><%= t('admin.models.event.one') %></th>
          <th><%= t('admin.table.date_time') %></th>
          <th><%= t('admin.models.calendar.one') %></th>
        </tr>
      </thead>
      <tbody>
        <% upcoming_events.each do |event| %>
          <tr>
            <td>
              <div class="font-medium"><%= truncate(event.summary, length: 50) %></div>
            </td>
            <td class="whitespace-nowrap text-sm">
              <%= event.dtstart.strftime('%a %d %b %H:%M') %>
            </td>
            <td>
              <% if event.calendar %>
                <%= link_to event.calendar.name, edit_admin_calendar_path(event.calendar), class: "link text-placecal-orange hover:text-orange-600 text-sm" %>
              <% end %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
<% else %>
  <%= render Admin::EmptyStateComponent.new(icon: :calendar, message: t('admin.time.no_upcoming_in_days', days: 30)) %>
<% end %>
