<% content_for :title do %>Edit User: <%= @user.full_name.presence || @user.email %><% end %>

<div class="flex items-center justify-between mb-6">
  <div>
    <h1 class="text-2xl font-semibold">Edit User</h1>
    <p class="text-base-content/60 mt-1"><%= @user.full_name.presence || @user.email %></p>
  </div>
  <div class="text-sm text-base-content/50">ID: <%= @user.id %></div>
</div>

<%- disabled_fields = policy(@user).disabled_attributes_for_update %>
<%- displayable_fields = policy(@user).permitted_attributes_for_update %>

<%= filtered_form_for(@user,
                     method: :put,
                     url: admin_user_path(@user),
                     disabled: disabled_fields,
                     display_only: displayable_fields,
                     html: { data: { controller: 'live-validation' } }) do |f| %>
  <%= render 'form', f: f %>

  <% if policy(@user).destroy? && !@user.site_admin? %>
    <div class="divider my-8"></div>

    <%= render Admin::DangerZoneComponent.new(
      title: "Delete this user",
      description: "Permanently remove this user account. This action cannot be undone.",
      button_text: "Delete User",
      button_path: admin_user_path(@user),
      confirm: "Please confirm you want to delete this user.\n\nThis is permanent!"
    ) %>
  <% end %>

  <%= render Admin::SaveBarComponent.new do |c| %>
    <% c.with_button do %>
      <%= f.submit t('admin.users.actions.save'), class: "btn bg-placecal-orange hover:bg-orange-600 text-white border-placecal-orange" %>
    <% end %>
  <% end %>
<% end %>
