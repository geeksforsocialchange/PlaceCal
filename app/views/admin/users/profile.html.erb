<h1 class="page-header">Edit Profile</h1>

<% if current_user.root? -%>
  <p>To modify neighbourhoods, tags and partners go to the <%= link_to 'user edit page', edit_admin_user_path(current_user) %>.</p>
<% end -%>

<%= simple_form_for current_user, as: :user, method: :patch, url: update_profile_admin_user_path(current_user), html: { class: "form-horizontal" } do |f| %>
  <div class="row mt-4">
    <%= render(Admin::ErrorComponent.new(current_user)) %>
    <div class="col-md-12">
      <h2>Basic information</h2>
      <%= render "contact", f: f %>
    </div>
  </div>

  <div class="row mt-4">
    <div class="col-md-6">
      <h2>Password</h2>
      <p>Leave this blank if you don't want to change your password.</p>
      <%= f.input :password, autocomplete: "off" %>
      <% if @minimum_password_length %>
        <br>
        <em><%= @minimum_password_length %> characters minimum</em>
      <% end %>
      <%= f.input :password_confirmation, autocomplete: "off" %>

      <%= f.input :current_password, autocomplete: "off", hint: 'Enter your current password if you want to change it' %>
    </div>
  </div>

  <div class="row mt-4">
    <div class="col-md-12">
      <h2>Admin rights</h2>
      <% if current_user.root? %>
        <div class="profile__is-root">
          <p>You are a <strong>root</strong> user and can do everything! be careful!</p>
        </div>
      <% else %>
        <% if user_has_no_rights?(current_user) -%>
          <p class='has-no-admin-rights-warning'>You have no admin rights. This probably means someone didn't set up your account correctly - please ask whoever invited you!</p>
        <% end -%>
      <% end %>
    </div>
  </div>
  <%# Your Permissions %>
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-6">
    <%# Partners %>
    <% if current_user.partners.any? %>
      <div class="card bg-base-100 border border-base-300 shadow-sm">
        <div class="card-body p-4">
          <div class="flex items-center gap-3 mb-3">
            <div class="w-9 h-9 rounded-lg bg-emerald-100 flex items-center justify-center">
              <%= icon(:partner, size: '5', css_class: 'text-emerald-600') %>
            </div>
            <h3 class="font-semibold"><%= t('admin.profile.your_partners') %></h3>
          </div>
          <%= render Admin::ItemBadgeListComponent.new(
            items: current_user.partners.order(:name),
            icon_name: :partner,
            icon_color: "bg-emerald-100 text-emerald-600",
            link_path: :edit_admin_partner_path,
            empty_text: t('admin.empty.none_assigned', items: Partner.model_name.human(count: 2).downcase)
          ) %>
        </div>
      </div>
    <% end %>

    <%# Neighbourhoods %>
    <% if current_user.neighbourhoods.any? %>
      <div class="card bg-base-100 border border-base-300 shadow-sm">
        <div class="card-body p-4">
          <div class="flex items-center gap-3 mb-3">
            <div class="w-9 h-9 rounded-lg bg-sky-100 flex items-center justify-center">
              <%= icon(:map_pin, size: '5', css_class: 'text-sky-600') %>
            </div>
            <h3 class="font-semibold"><%= t('admin.profile.your_neighbourhoods') %></h3>
          </div>
          <%= render Admin::ItemBadgeListComponent.new(
            items: current_user.neighbourhoods.order(:name),
            icon_name: :map_pin,
            icon_color: "bg-sky-100 text-sky-600",
            link_path: :edit_admin_neighbourhood_path,
            empty_text: t('admin.empty.none_assigned', items: Neighbourhood.model_name.human(count: 2).downcase)
          ) %>
        </div>
      </div>
    <% end %>

    <%# Partnerships/Tags %>
    <% if current_user.partnership_admin? %>
      <div class="card bg-base-100 border border-base-300 shadow-sm">
        <div class="card-body p-4">
          <div class="flex items-center gap-3 mb-3">
            <div class="w-9 h-9 rounded-lg bg-amber-100 flex items-center justify-center">
              <%= icon(:partnership, size: '5', css_class: 'text-amber-600') %>
            </div>
            <h3 class="font-semibold"><%= t('admin.profile.your_partnerships') %></h3>
          </div>
          <p class="text-sm text-base-content/60 mb-3"><%= t('admin.profile.partnerships_hint') %></p>
          <%= render Admin::ItemBadgeListComponent.new(
            items: current_user.tags.order(:name),
            icon_name: :partnership,
            icon_color: "bg-amber-100 text-amber-600",
            link_path: :edit_admin_tag_path,
            empty_text: t('admin.empty.none_assigned', items: Partnership.model_name.human(count: 2).downcase)
          ) %>
        </div>
      </div>
    <% end %>
  </div>

  <br><br>
  <%= f.submit "Update", class: "btn btn-primary " %>
<% end %>
