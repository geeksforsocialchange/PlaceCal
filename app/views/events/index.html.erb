<% content_for :title, "Events" %>
<% content_for :image, @site.og_image %>
<% content_for :description, @site.og_description %>

<%= render(HeroComponent.new("Events & activities", @site.tagline)) %>

<div class="c c--lg-space-after">
  <%= turbo_frame_tag "events-browser", data: { turbo_action: "advance" } do %>
    <div class="paginator" id="paginator">
      <div class="paginator__context">
        <%= render(BreadcrumbComponent.new(trail: [['Events', events_path]], site_name: @site.name)) do %>
          <div class="breadcrumb__actions">
            <% today = Time.zone.today %>
            <%= render(EventFilterComponent.new(
              pointer: @current_day,
              period: @period,
              sort: @sort,
              repeating: @repeating,
              today_url: "/events/#{today.year}/#{today.month}/#{today.day}?period=#{@period}&sort=#{@sort}&repeating=#{@repeating}#paginator",
              today: @current_day == today
            )) %>
          </div>
        <% end %>
      </div>
      <%= render(TimelineComponent.new(
        pointer: @current_day,
        period: @period,
        sort: @sort,
        repeating: @repeating,
        path: 'events'
      )) %>
    </div>
    <hr>
    <%= render(EventListComponent.new(
      events: @events,
      period: @period,
      primary_neighbourhood: @primary_neighbourhood,
      show_neighbourhoods: @current_site.show_neighbourhoods?,
      badge_zoom_level: @current_site.badge_zoom_level,
      next_date: @next,
      site_tagline: @site.tagline,
      truncated: @truncated
    )) %>
  <% end %>
</div>

<%= render(Meta.new('/hello/world')) do |component| %>
  <% component.with_link do %>
    <%= link_to "Subscribe to #{@title} with iCal", events_url(protocol: :webcal, format: :ics) %>
  <% end %>
<% end %>
